<!DOCTYPE html>
<html>
<head>
<title>Smart TV Remote (Auto-Connect)</title>
<style>
body { font-family: Arial; text-align: center; background:#111; color:white; }
button { padding:15px; margin:5px; font-size:16px; cursor:pointer; }
.pad button { width:60px; }
input { padding:10px; width:70%; margin-top:10px; }
h2, h3 { margin-top:20px; }
#status { margin-bottom: 10px; color: #0f0; }
</style>
</head>
<body>

<h2>üì∫ Smart TV Remote</h2>
<div id="status">Scanning for TVs...</div>
<div id="tv-list"></div>

<!-- Controls -->
<div id="controls" style="display:none;">
  <!-- POWER -->
  <button onclick="key(26)">‚èª Power</button>

  <!-- VOLUME -->
  <div>
    <button onclick="key(24)">üîä +</button>
    <button onclick="key(25)">üîâ -</button>
    <button onclick="key(164)">üîá Mute</button>
  </div>

  <!-- NAVIGATION -->
  <div class="pad">
    <br>
    <button onclick="key(19)">‚¨Ü</button><br>
    <button onclick="key(21)">‚¨Ö</button>
    <button onclick="key(66)">OK</button>
    <button onclick="key(22)">‚û°</button><br>
    <button onclick="key(20)">‚¨á</button>
  </div>

  <!-- SYSTEM -->
  <div>
    <button onclick="key(3)">üè† Home</button>
    <button onclick="key(4)">‚Ü© Back</button>
    <button onclick="key(82)">‚ò∞ Menu</button>
  </div>

  <!-- MEDIA -->
  <div>
    <button onclick="key(85)">‚èØ Play/Pause</button>
  </div>

  <!-- APPS -->
  <h3>Apps</h3>
  <button onclick="app('com.google.android.youtube.tv')">YouTube</button>
  <button onclick="app('com.netflix.ninja')">Netflix</button>

  <!-- KEYBOARD -->
  <h3>Keyboard</h3>
  <input id="text" placeholder="Type here">
  <button onclick="sendText()">Send</button>
</div>

<script>
const API = "http://localhost:3000";
let TVConnected = false;

// Scan LAN for TVs
async function scanTVs() {
  document.getElementById("status").innerText = "Scanning for TVs...";
  const res = await fetch(API + "/scan");
  const devices = await res.json();
  const tvListDiv = document.getElementById("tv-list");
  tvListDiv.innerHTML = "";
  if(devices.length===0){
    document.getElementById("status").innerText = "No TVs found";
    return;
  }
  devices.forEach(d=>{
    const btn = document.createElement("button");
    btn.innerText = d.ip;
    btn.onclick = ()=>connectTV(d.ip);
    tvListDiv.appendChild(btn);
  });
  document.getElementById("status").innerText = "Select a TV to connect";
}

// Connect to TV
async function connectTV(ip){
  const res = await fetch(API + "/connect",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ip})
  });
  if(res.ok){
    TVConnected = true;
    document.getElementById("status").innerText = "Connected to " + ip;
    document.getElementById("controls").style.display = "block";
    document.getElementById("tv-list").style.display = "none";
  }
}

// Control functions
function key(code){
  if(!TVConnected) return alert("Connect to a TV first");
  fetch(API + "/key",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({code})});
}

function sendText(){
  if(!TVConnected) return alert("Connect to a TV first");
  fetch(API + "/text",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({text:document.getElementById("text").value})});
}

function app(pkg){
  if(!TVConnected) return alert("Connect to a TV first");
  fetch(API + "/app",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({pkg})});
}

// Start scanning on load
scanTVs();
</script>

</body>
</html>
